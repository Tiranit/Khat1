name: Run Trading Script Every Hour

on:
  schedule:
    - cron: '0 * * * *'  # هر یک ساعت

jobs:
  run-script:
    runs-on: ubuntu-latest

    env:
      HTTP_PROXY: 141.145.214.176:80
      HTTPS_PROXY: 141.145.214.176:80

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'  # نسخه پایتون

    - name: Configure proxy
      run: |
        echo "Acquire::http::Proxy \"$HTTP_PROXY\";" | sudo tee /etc/apt/apt.conf.d/proxy.conf
        echo "Acquire::https::Proxy \"$HTTPS_PROXY\";" | sudo tee -a /etc/apt/apt.conf.d/proxy.conf

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install ccxt numpy pandas mplfinance

    - name: Run Python script
      env:
        SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
        RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        HTTP_PROXY: ${{ env.HTTP_PROXY }}
        HTTPS_PROXY: ${{ env.HTTPS_PROXY }}
      run: |
        python main.py
